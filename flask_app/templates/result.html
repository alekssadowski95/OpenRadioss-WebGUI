<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Title -->
<title>OpenRadioss</title>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-5.3.3-dist/css/bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-icons-1.11.3/font/bootstrap-icons.min.css') }}">

<!-- Favicon -->
<link rel="icon" type="image/png" sizes="48x48" href="{{ url_for('static', filename='ross.png') }}">

<style>
    .viewer {
        overflow: hidden;
    
        background: #11e8bb; /* Old browsers */
        background: -moz-linear-gradient(top,  #aaa 0%,#fff 50%, #aaa 100%); /* FF3.6-15 */
        background: -webkit-linear-gradient(top,  #aaa 0%,#fff 50%,#aaa 100%); /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(to bottom,  #aaa 0%,#fff 50%,#aaa 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#aaa', endColorstr='#FFF',GradientType=0 ); /* IE6-9 */
        
        background-color: white;
        opacity: 1;
        background-image: 
            radial-gradient(rgb(221, 221, 221) 1.35px, #f5f5f5 1.35px), 
            radial-gradient(circle, rgba(14,32,88,1) 75%, rgba(18,32,74,1) 100%);
        background-size: 27px 27px;
    }
    .result-card{
    }
    .result-card:hover {
        cursor: pointer;
        background-color: #f5f5f5;
    }
    .result-card-active {
    }
    .result-card-active:hover {
        cursor: pointer;

    }
</style>
<body style="height: 100vh; min-height:100vh; max-height: 100vh;">
<header class="px-3 py-2 border-bottom" style="background-color: #ffffff;">
    <div class="d-flex flex-wrap justify-content-center">
    <a href="/" class="d-flex align-items-center mb-3 mb-lg-0 me-lg-auto link-body-emphasis text-decoration-none">
        <img class="bi me-2" src="{{ url_for('static', filename='ross.png') }}" height="28"></img>
        <span class="fs-5" style="color: black;">OpenRadioss</span>
    </a>
    <a type="button" href="{{ url_for('upload_calculix_input') }}" class="btn btn-outline-secondary">Home</a>
    </div>
</header>
<div class="row p-0 m-0" style="height:calc(100% - 55px)">    
    <div class="col-10 p-0 m-0" style="height: 100%">
        <div class="tab-content" id="nav-tabContent" style="height: 100%">
            <nav class="p-0 m-0" style="padding-left: 20px;">
                <div class="nav nav-tabs p-1 m-0 flex" id="nav-tab" role="tablist">
                    <button class="text-start nav-link active px-3 py-1" id="nav-rad-anim-tab" data-bs-toggle="tab" data-bs-target="#tab-rad-anim" type="button" role="tab" aria-controls="nav-profile" aria-selected="true" style="color: black; font-size: 1rem;">Result</button>
                    <button class="text-start nav-link px-3 py-1" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#tab-rad-0000" type="button" role="tab" aria-controls="nav-home" aria-selected="false" style="color: black; font-size: 1rem;">*0000.rad</button>
                    <button class="text-start nav-link px-3 py-1" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#tab-rad-0001" type="button" role="tab" aria-controls="nav-profile" aria-selected="false" style="color: black; font-size: 1rem;">*0001.rad</button>
                    <button class="text-start nav-link px-3 py-1" id="nav-inp-tab" data-bs-toggle="tab" data-bs-target="#tab-inp" type="button" role="tab" aria-controls="nav-profile" aria-selected="false" style="color: black; font-size: 1rem;">*.inp</button>
                </div>
            </nav>
            <div class="tab-pane fade show active" id="tab-rad-anim" role="tabpanel" aria-labelledby="nav-rad-anim-tab" tabindex="0" style="height: calc(100% - 42px);">
                <div class="viewer p-0 m-0" style="height: 100%;">
                    <iframe id="main-view-iframe" src="{{ url_for('viewer', filename='') }}" frameborder="0" style="height: 100%; width: 100%; display: block;"></iframe>
                </div>
            </div>
            <div class="tab-pane fade" id="tab-rad-0000" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="1" style="height: calc(100% - 42px);">
                <div style="background-color: #222222; padding-left: 20px; padding-top: 10px; color: white; height: 100%; overflow-y: scroll;">
                    <span style="white-space: pre-line; ">{{ content_0 }}</span>
                </div>
            </div>
            <div class="tab-pane fade" id="tab-rad-0001" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="2" style="height: calc(100% - 42px);">
                <div style="background-color: #222222; padding-left: 20px; padding-top: 10px; color: white; height: 100%; overflow-y: scroll;">
                    <span style="white-space: pre-line;">{{ content_1 }}</span>
                </div>
            </div>
            <div class="tab-pane fade" id="tab-inp" role="tabpanel" aria-labelledby="nav-inp-tab" tabindex="3" style="height: calc(100% - 42px);">
                <div style="background-color: #222222; padding-left: 20px; padding-top: 10px; color: white; height: 100%; overflow-y: scroll;">
                    <span style="white-space: pre-line;">{{ calculix_inp }}</span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-2 p-0 m-0" style="border-left-width: 1px; border-left-style: solid; border-color:lightgray; height: 100%;">
        <div style="height: 42px; border-bottom-width: 1px; border-bottom-style: solid; border-color:lightgray; display: flex; align-items: center; padding-left: 8px;">
            Steps
        </div>        
        <div id="resultsList" style="height: calc(100% - 42px); padding: 8px; overflow-y: scroll;"></div>
    </div>
</div>
    


<script src="{{ url_for('static', filename='bootstrap-5.3.3-dist/js/bootstrap.min.js') }}"></script>
<script>
    var selectedResultID = 0;

    function loadAnimationFile(animFileName, resultID){
        selectedResultID = resultID;
        console.log(`Selected animation file ${animFileName}`);
        var viewerIframe = document.getElementById("main-view-iframe");
        viewerIframe.src = `http://localhost:5000/viewer/${animFileName}`;
    }

    function updateDiv(divId, newText) {
        // Get the div element by ID
        var div = document.getElementById(divId);

        resultListHTML = '';
        // Check if the div exists
        if (div) {
            // Update the content of the div
            resultListTemp = JSON.parse(newText);
            
            for (let i = 0; i < resultListTemp.length; i++) {
                if ((i + 1) == selectedResultID) {
                    resultListHTML = resultListHTML + `
                    <div style="padding: 2px;" class="card mb-2 result-card-active bg-success text-white" onclick="loadAnimationFile('${resultListTemp[i][1]}', ${i + 1})">
                        <div class="card-body">
                            ${resultListTemp[i][1]}
                        </div>
                    </div>
                    `
                } else {
                    resultListHTML = resultListHTML + `
                    <div style="padding: 2px;" class="card mb-2 result-card " onclick="loadAnimationFile('${resultListTemp[i][1]}', ${i + 1})">
                        <div class="card-body">
                            ${resultListTemp[i][1]}
                        </div>
                    </div>
                    `
                }

            }
            div.innerHTML = resultListHTML;
            console.log("Updated results list")
        } else {
            console.error("Div with ID '" + divId + "' not found.");
        }
    }

    // Function to fetch data from localhost:5000 and update the div
    type = 0;
    function autoUpdateDiv(divId) {
        setInterval(function() {
            fetch('http://localhost:5000/get-result-list')
                .then(response => response.text()) // Assuming the response is plain text
                .then(data => {
                    updateDiv(divId, data);
                })
                .catch(error => console.error("Error fetching data:", error));
        }, 1000);
    }

    autoUpdateDiv("resultsList");
</script>
</body>
</html>